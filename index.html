<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>Vaadin Bugrap with polymer</title>
    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="/bower_components/moment/moment.js"></script>
    <script src='/bower_components/firebase/firebase.js'></script>
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script src="/bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="elements.html">
    <link rel="import" href="css/custom-style.html">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="fullbleed layout vertical">
<template is="dom-bind" id="app">

    <dom-module id="vaadin-bugrap">
        <template>
            <!-- Firebase collections -->
            <firebase-collection
                    order-by-child="project_id"
                    location="https://vaadin-bugrap.firebaseio.com/project"
                    data="{{projects}}">
            </firebase-collection>

            <paper-header-panel class="blue">
                <paper-toolbar class="paper-header">
                    <paper-dropdown-menu label="Choose project" id="project_select_dropdown" class="project_select_dropdown">
                        <paper-listbox class="dropdown-content" id="project_select" attr-for-selected="value" selected="{{filters.project}}">
                            <template is="dom-repeat" items="[[projects]]" as="project">
                                <paper-item value="[[project.project_id]]">[[project.name]]</paper-item>
                            </template>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <span class="spacer"></span>
                    <iron-label>
                        <paper-icon-button icon="social:person"></paper-icon-button>
                        <span class="black button_label hide_mobile">Sami Suo-Heikki</span>
                    </iron-label>

                    <iron-label>
                        <paper-icon-button icon="icons:input"></paper-icon-button>
                        <span class="black button_label hide_mobile">Logout</span>
                    </iron-label>
                </paper-toolbar>
                <div>
                    <div class="container flex-horizontal">
                        <iron-label class="search_row_label">
                            <paper-icon-button icon="icons:bug-report" class="black"></paper-icon-button>
                            <span class="black button_label hide_mobile">Report a bug</span>
                        </iron-label>
                        <iron-label class="search_row_label">
                            <paper-icon-button icon="icons:chrome-reader-mode" class="black"></paper-icon-button>
                            <span class="black button_label hide_mobile">Request a feature</span>
                        </iron-label>
                        <iron-label class="flexchild search_row_label">
                            <paper-icon-button icon="icons:settings" class="black"></paper-icon-button>
                            <span class="black button_label hide_mobile">Manage project</span>
                        </iron-label>
                        <paper-input class="short search_report" label="Search reports" style="" id="search_reports" value="{{filters.searchFilter}}" no-label-float>
                            <paper-icon-button suffix icon="search" alt="search" title="Search" class="black">
                            </paper-icon-button>
                        </paper-input>
                    </div>
                    <div class="container flex-horizontal">
                        <paper-dropdown-menu label="Reports for" id="reports_for" style="padding-left: 10px">
                            <paper-menu class="dropdown-content" attr-for-selected="name" selected="{{filters.version}}" id="version_menu">
                                <template is="dom-repeat" items="{{versions}}">
                                    <paper-item value="{{item.version_id}}" name="{{item.version_id}}">{{item.name}}</paper-item>
                                </template>
                            </paper-menu>
                        </paper-dropdown-menu>
                        <distribution-bar class="flexchild" style="padding-top: 33px; padding-left: 15px;" id="distribution_bar_top">
                        </distribution-bar>
                    </div>
                </div>
            </paper-header-panel>
            <paper-toolbar class="white">
                <paper-tabs class="tab-filter" attr-for-selected="name" selected="{{filters.assignee}}">
                    <paper-tab disabled="true" class="tab-filter-text hide_mobile">
                        Assignees
                    </paper-tab>
                    <paper-tab name="me" class="tab-select">
                        <span class="hide_mobile">Only me</span>
                        <iron-icon icon="social:person-outline" class="hide_desktop"></iron-icon>
                    </paper-tab>
                    <paper-tab name="everyone" class="tab-select">
                        <span class="hide_mobile">Everyone</span>
                        <iron-icon icon="social:people-outline" class="hide_desktop"></iron-icon>
                    </paper-tab>
                </paper-tabs>
                <paper-radio-group class="status-dialog closed">
                    <template is="dom-repeat" items="{{statuses}}">
                        <paper-checkbox style="display: block;" class="custom_filter_checkbox" name="{{item.status_id}}" on-change="customStatusChanged">{{item.name}}</paper-checkbox>
                    </template>
                </paper-radio-group>
                <paper-tabs class="tab-filter" attr-for-selected="name" selected="{{filters.status}}">
                    <paper-tab disabled="true" class="tab-filter-text hide_mobile">
                        <span class="hide_mobile">Status</span>
                    </paper-tab>
                    <paper-tab name="open" class="tab-select">
                        <span class="hide_mobile">Open</span>
                        <iron-icon icon="icons:radio-button-unchecked" class="hide_desktop"></iron-icon>
                    </paper-tab>
                    <paper-tab name="all_kind" class="tab-select">
                        <span class="hide_mobile">All kinds</span>
                        <iron-icon icon="icons:radio-button-checked" class="hide_desktop"></iron-icon>
                    </paper-tab>
                    <paper-tab id="status-select" name="custom" class="tab-select"><!--
                        --><span class="hide_mobile">Custom
                            <iron-icon icon="icons:arrow-drop-down" id="status_select_down"></iron-icon>
                            <iron-icon icon="icons:arrow-drop-up" id="status_select_up" style="display: none"></iron-icon>
                        </span>
                        <iron-icon icon="icons:more-vert" class="hide_desktop"></iron-icon>
                    </paper-tab>
                </paper-tabs>
            </paper-toolbar>
            <div id="report-grid">
                <vaadin-grid selection-mode="multi">
                    <table>
                        <colgroup>
                            <col name="version_id" sortable="true" sort-direction="asc">
                            <col name="priority" sortable="true">
                            <col name="type_id" sortable="true">
                            <col name="meta" sortable="true" flex>
                            <col name="employee_id" sortable="true">
                            <col name="modifytime" sortable="true">
                            <col name="createtime" sortable="true">
                        </colgroup>
                        <thead>
                        <tr>
                            <th>Version</th>
                            <th>Priority</th>
                            <th>Type</th>
                            <th>Summary</th>
                            <th>Assigned to</th>
                            <th>Last modified</th>
                            <th>Reported</th>
                        </tr>
                        </thead>
                    </table>
                </vaadin-grid>
            </div>
            <paper-toast id="validation_error" text="Please fill all the fields."></paper-toast>
            <paper-toast id="comment_validation_error" text="Please add your comment."></paper-toast>

            <div id="report_edit_container" class="resizable">
                <div id="handle" class="ui-resizable-handle ui-resizable-n">
                </div>
                <div id="report_edit" style="display: none;">
                    <paper-header-panel class="secondary-blue">
                        <paper-toolbar class="paper-header" style="display: none;" id="report_edit_name">
                            <iron-label>
                                <paper-icon-button icon="icons:open-in-new" class="black"></paper-icon-button>
                                <span class="black button_label">{{selectedReportMeta}}</span>
                            </iron-label>
                        </paper-toolbar>
                        <paper-toolbar class="paper-header" style="display: none;" id="report_edit_amount">
                            <iron-label>
                                <span class="black button_label">{{selectedReportAmount}} reports selected</span>
                                <span class="grey button_label">&nbsp;- Select a single report to view it contents</span>
                            </iron-label>
                        </paper-toolbar>
                        <paper-toolbar class="paper-header" id="report_edit_fields">
                            <paper-dropdown-menu label="Priority" required="true">
                                <paper-listbox class="dropdown-content" id="report_select_priority" attr-for-selected="name">
                                    <template is="dom-repeat" items="{{priorities}}">
                                        <paper-item value="{{item.number}}" name="{{item.number}}">{{item.text}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</paper-item>
                                    </template>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <paper-dropdown-menu label="Type">
                                <paper-listbox class="dropdown-content" id="report_select_type_id" attr-for-selected="name">
                                    <template is="dom-repeat" items="{{types}}">
                                        <paper-item value="{{item.type_id}}" name="{{item.type_id}}">{{item.name}}</paper-item>
                                    </template>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <paper-dropdown-menu label="Status">
                                <paper-listbox class="dropdown-content" id="report_select_status_id" attr-for-selected="name">
                                    <template is="dom-repeat" items="{{statuses}}">
                                        <paper-item value="{{item.status_id}}" name="{{item.status_id}}">{{item.name}}</paper-item>
                                    </template>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <paper-dropdown-menu label="Assigned To">
                                <paper-listbox class="dropdown-content" id="report_select_employee_id" attr-for-selected="name">
                                    <paper-item value="0" name="0">No assignee</paper-item>
                                    <template is="dom-repeat" items="{{employees}}">
                                        <paper-item value="{{item.employee_id}}" name="{{item.employee_id}}">{{item.firstname}} {{item.lastname}}</paper-item>
                                    </template>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <paper-dropdown-menu label="Version">
                                <paper-listbox class="dropdown-content" id="report_select_version_id" attr-for-selected="name">
                                    <template is="dom-repeat" items="{{versionsWithoutAll}}">
                                        <paper-item value="{{item.version_id}}" name="{{item.version_id}}">{{item.name}}</paper-item>
                                    </template>
                                </paper-listbox>
                            </paper-dropdown-menu>
                            <span class="spacer"></span>
                            <paper-button class="update" raised on-click="updateReports">Update</paper-button>
                            <paper-button class="discard" raised on-click="discardReportsEdit">Revert</paper-button>
                            <paper-button class="comment" raised on-click="showCommentAdd" id="comment_button">Add comment</paper-button>
                        </paper-toolbar>
                        <div id="report_comments" style="overflow: auto;">
                            <div id="comment_add" style="display: none">
                                <textarea></textarea>
                                <div class="container flex-horizontal">
                                    <paper-button on-click="addComment" raised>Done</paper-button>
                                    <paper-button raised>Attachment</paper-button>
                                    <paper-button on-click="commentCancel" raised>Cancel</paper-button>
                                </div>
                            </div>
                            <template is="dom-repeat" items="{{reportComments}}">
                                <div class="container flex-vertical">
                                    <div style="margin-bottom: 2px"><paper-icon-button icon="social:person" class="grey"></paper-icon-button> {{item.employee}} &nbsp;<span class="grey">({{item.timestamp}})</span></div>
                                    <div style="margin-left: 44px;" class="report_comment"></div>
                                    <input type="hidden" class="report_comment_input" value="{{item.comment_id}}">
                                </div>
                            </template>
                        </div>
                    </paper-header-panel>
                </div>
            </div>

        </template>
        <script src="js/vaadin-bugrap.js"></script>
    </dom-module>
    <vaadin-bugrap></vaadin-bugrap>
</template>
</body>
</html>